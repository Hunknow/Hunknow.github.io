<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>三江源平台（简化版）</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; background: #f0f0f0; min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: white; border-radius: 10px; padding: 30px; margin: 20px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn { padding: 12px 24px; background: #0E7C7B; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #0b6a69; }
        .input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        .hidden { display: none; }
        .text-center { text-align: center; }
        .text-red { color: #e53e3e; }
        .text-green { color: #38a169; }
        .mb-4 { margin-bottom: 16px; }
        .mt-4 { margin-top: 16px; }
        .flex { display: flex; justify-content: space-between; align-items: center; }
        .data-item { padding: 15px; border-left: 4px solid #0E7C7B; margin: 10px 0; background: #f9f9f9; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- 登录区域 -->
        <div id="authSection" class="card">
            <h1 class="text-center mb-4">三江源生态智能问答平台</h1>
            
            <h2 class="text-center mb-4">用户登录</h2>
            <div class="mb-4">
                <label>手机号</label>
                <input type="tel" id="loginPhone" class="input" placeholder="18597123311（管理员）">
            </div>
            <div class="mb-4">
                <label>密码</label>
                <input type="password" id="loginPwd" class="input" placeholder="Hm123321（管理员密码）">
            </div>
            <button class="btn" style="width: 100%;" onclick="loginUser()">登录</button>
            
            <div id="authMessage" class="mt-4 text-center"></div>
        </div>

        <!-- 主应用区域 -->
        <div id="appSection" class="card hidden">
            <div class="flex mb-4">
                <h3>欢迎 <span id="userNameDisplay"></span></h3>
                <button class="btn" onclick="logout()">退出</button>
            </div>
            
            <!-- 生态数据 -->
            <h3 class="mb-4">生态监测数据</h3>
            <div id="ecologicalDataList"></div>
            
            <!-- 物种记录 -->
            <h3 class="mt-4 mb-4">物种记录</h3>
            <div id="speciesDataList"></div>
            
            <!-- 智能问答 -->
            <h3 class="mt-4 mb-4">智能问答</h3>
            <textarea id="questionInput" class="input" rows="3" placeholder="请输入问题..."></textarea>
            <button class="btn mt-4" onclick="askQuestion()">提问</button>
            <div id="qaHistory" class="mt-4"></div>
        </div>
    </div>

    <script>
        // ========== Supabase配置 ==========
        const SUPABASE_URL = 'https://pnakeholshmrtwctzqcb.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_tVf76wqdUIvhiNUymxKHEA_FAMmDvf3';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // ========== 登录 ==========
        async function loginUser() {
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPwd').value.trim();
            const messageDiv = document.getElementById('authMessage');
            
            if (phone === '18597123311' && password === 'Hm123321') {
                document.getElementById('userNameDisplay').textContent = '管理员';
                showMainApp();
                return;
            }
            
            messageDiv.innerHTML = '<p class="text-red">管理员账号：18597123311 / Hm123321</p>';
        }
        
        // ========== 显示主应用 ==========
        function showMainApp() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('appSection').classList.remove('hidden');
            loadEcologicalData();
            loadSpeciesData();
        }
        
        // ========== 加载生态数据 ==========
        async function loadEcologicalData() {
            const div = document.getElementById('ecologicalDataList');
            try {
                const { data, error } = await supabase.from('ecological_data').select('*').limit(10);
                if (error) {
                    div.innerHTML = `<p class="text-red">加载失败: ${error.message}</p>`;
                    return;
                }
                div.innerHTML = data.map(item => `
                    <div class="data-item">
                        <h4>${item.data_type}</h4>
                        <p>位置: ${item.location} | 数值: ${item.value} ${item.unit}</p>
                        <p>日期: ${item.record_date}</p>
                    </div>
                `).join('');
            } catch (err) {
                div.innerHTML = `<p class="text-red">异常: ${err.message}</p>`;
            }
        }
        
        // ========== 加载物种数据 ==========
        async function loadSpeciesData() {
            const div = document.getElementById('speciesDataList');
            try {
                const { data, error } = await supabase.from('species_records').select('*').limit(10);
                if (error) {
                    div.innerHTML = `<p class="text-red">加载失败: ${error.message}</p>`;
                    return;
                }
                div.innerHTML = data.map(item => `
                    <div class="data-item">
                        <h4>${item.species_name}</h4>
                        <p>数量: ${item.count} | 位置: ${item.location}</p>
                        <p>日期: ${item.observation_date}</p>
                    </div>
                `).join('');
            } catch (err) {
                div.innerHTML = `<p class="text-red">异常: ${err.message}</p>`;
            }
        }
        
        // ========== 智能问答 ==========
        async function askQuestion() {
            const input = document.getElementById('questionInput');
            const question = input.value.trim();
            if (!question) return;
            
            const answer = getMockAnswer(question);
            const div = document.getElementById('qaHistory');
            const qaItem = document.createElement('div');
            qaItem.className = 'data-item';
            qaItem.innerHTML = `<p><strong>问:</strong> ${question}</p><p><strong>答:</strong> ${answer}</p>`;
            div.insertBefore(qaItem, div.firstChild);
            
            input.value = '';
        }
        
        // ========== 模拟回答 ==========
        function getMockAnswer(q) {
            const question = q.toLowerCase();
            if (question.includes('珍稀物种')) return "三江源的珍稀物种包括雪豹、藏羚羊、野牦牛、黑颈鹤等国家一级保护动物16种。";
            if (question.includes('保护措施')) return "三江源保护措施包括生态修复、退牧还草、生态移民、社区共管等。";
            return "三江源位于青海省南部，是长江、黄河、澜沧江的发源地，被称为'中华水塔'。";
        }
        
        // ========== 退出 ==========
        function logout() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('appSection').classList.add('hidden');
        }
    </script>
</body>
</html>
